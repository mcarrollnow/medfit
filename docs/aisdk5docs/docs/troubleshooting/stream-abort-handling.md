AI SDK 5 is available now.










Menu




































































































































































































































































































































































































































































































# [onFinish not called when stream is aborted](#onfinish-not-called-when-stream-is-aborted)

## [Issue](#issue)

When using `toUIMessageStreamResponse` with an `onFinish` callback, the callback may not execute when the stream is aborted. This happens because the abort handler immediately terminates the response, preventing the `onFinish` callback from being triggered.



``` tsx
// Server-side code where onFinish isn't called on abortexport async function POST(req: Request)  = await req.json();
  const result = streamText();
  return result.toUIMessageStreamResponse() =>  else     },  });}
```


## [Background](#background)

When a stream is aborted, the response is immediately terminated. Without proper handling, the `onFinish` callback has no chance to execute, preventing important cleanup operations like saving partial results or logging abort events.

## [Solution](#solution)

Add `consumeStream` to the `toUIMessageStreamResponse` configuration. This ensures that abort events are properly captured and forwarded to the `onFinish` callback, allowing it to execute even when the stream is aborted.



``` tsx
// other imports...import  from 'ai';
export async function POST(req: Request)  = await req.json();
  const result = streamText();
  return result.toUIMessageStreamResponse() =>  else     },    consumeSseStream: consumeStream, // This enables onFinish to be called on abort  });}
```

















On this page






















Vercel delivers the infrastructure and developer experience you need to ship reliable AI-powered applications at scale.

Trusted by industry leaders:















#### Resources




#### More




#### About Vercel




#### Legal







Â© 2025 Vercel, Inc.