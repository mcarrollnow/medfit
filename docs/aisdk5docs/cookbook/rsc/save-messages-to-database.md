AI SDK 5 is available now.










Menu





























































































































































































































































































































































































































































# [Save Messages To Database](#save-messages-to-database)

Sometimes conversations with language models can get interesting and you might want to save the state of so you can revisit it or continue the conversation later.

`createAI` has an experimental callback function called `onSetAIState` that gets called whenever the AI state changes. You can use this to save the AI state to a file or a database.

## [Client](#client)












``` tsx
import  from './actions';import  from './ai';
export default function RootLayout(: Readonly<>)  initialUIState=>                  </AI>      </body>    </html>  );}
```













``` tsx
'use client';
import  from 'react';import  from './actions';import  from '@ai-sdk/rsc';import  from 'ai';
// Allow streaming responses up to 30 secondsexport const maxDuration = 30;
export default function Home()  = useActions();
  return (    <div>      <div>        >            :           </div>        ))}      </div>
      <div>        <input          type="text"          value=          onChange=}        />        <button          onClick=,            ]);
            const message = await continueConversation(input);
            setConversation((currentConversation: ClientMessage[]) => [              ...currentConversation,              message,            ]);          }}        >          Send Message        </button>      </div>    </div>  );}
```


## [Server](#server)

We will use the callback function to listen to state changes and save the conversation once we receive a `done` event.












``` tsx
'use server';
import  from '@ai-sdk/rsc';import  from '@ai-sdk/openai';import  from 'react';import  from 'zod';import  from 'ai';import  from '@ai-studio/components/stock';
export interface ServerMessage 
export interface ClientMessage 
export async function continueConversation(  input: string,): Promise<ClientMessage> ],    text: () => ,          ,        ]);      }
      return <div></div>;    },    tools: ),        generate: async () => ),            },          ]);
          return <Stock symbol= numOfMonths= />;        },      },    },  });
  return ;}
```













``` ts
import  from '@ai-sdk/rsc';import  from './actions';
export const AI = createAI<ServerMessage[], ClientMessage[]>(,  onSetAIState: async () =>   },  onGetUIState: async () => ) => ( /> : content,    }));  },});
```

















On this page



















Vercel delivers the infrastructure and developer experience you need to ship reliable AI-powered applications at scale.

Trusted by industry leaders:















#### Resources




#### More




#### About Vercel




#### Legal







Â© 2025 Vercel, Inc.