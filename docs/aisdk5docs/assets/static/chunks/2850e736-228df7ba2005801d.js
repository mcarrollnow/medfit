"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4234],{93355:(e,t,a)=>{a.d(t,{PD:()=>tc,Pu:()=>td,V6:()=>tn});var r,s,i,o,n,l,u,c,p,d,h,g=a(81919),m=a(70700),f=a(91153),b=Object.defineProperty,z="AI_NoOutputSpecifiedError",y=`vercel.ai.error.${z}`,v=Symbol.for(y),I=class extends m.AX{constructor({message:e="No output specified."}={}){super({name:z,message:e}),this[r]=!0}static isInstance(e){return m.AX.hasMarker(e,y)}};r=v;var E="AI_InvalidArgumentError",A=`vercel.ai.error.${E}`,T=Symbol.for(A),x=class extends m.AX{constructor({parameter:e,value:t,message:a}){super({name:E,message:`Invalid argument for parameter ${e}: ${a}`}),this[s]=!0,this.parameter=e,this.value=t}static isInstance(e){return m.AX.hasMarker(e,A)}};s=T;var w="AI_RetryError",S=`vercel.ai.error.${w}`,_=Symbol.for(S),R=class extends m.AX{constructor({message:e,reason:t,errors:a}){super({name:w,message:e}),this[i]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return m.AX.hasMarker(e,S)}};i=_;var j=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2}={})=>async r=>C(r,{maxRetries:e,delayInMs:t,backoffFactor:a});async function C(e,{maxRetries:t,delayInMs:a,backoffFactor:r},s=[]){try{return await e()}catch(l){if(isAbortError(l)||0===t)throw l;let i=getErrorMessage(l),o=[...s,l],n=o.length;if(n>t)throw new R({message:`Failed after ${n} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:o});if(l instanceof Error&&APICallError.isInstance(l)&&!0===l.isRetryable&&n<=t)return await delay(a),C(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r},o);if(1===n)throw l;throw new R({message:`Failed after ${n} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:o})}}var k=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],N=e=>{let t="string"==typeof e?convertBase64ToUint8Array(e):e,a=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(a+10)},O="AI_DownloadError",M=`vercel.ai.error.${O}`,D=Symbol.for(M),P=class extends m.AX{constructor({url:e,statusCode:t,statusText:a,cause:r,message:s=null==r?`Failed to download ${e}: ${t} ${a}`:`Failed to download ${e}: ${r}`}){super({name:O,message:s,cause:r}),this[o]=!0,this.url=e,this.statusCode=t,this.statusText=a}static isInstance(e){return m.AX.hasMarker(e,M)}};async function F({url:e}){var t;let a=e.toString();try{let e=await fetch(a);if(!e.ok)throw new P({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(P.isInstance(e))throw e;throw new P({url:a,cause:e})}}o=D;var B=Symbol.for("vercel.ai.error.AI_InvalidDataContentError");m.AX;var U=f.z.union([f.z.string(),f.z.instanceof(Uint8Array),f.z.instanceof(ArrayBuffer),f.z.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function $(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new AISDKError6({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}var L="AI_InvalidMessageRoleError",X=`vercel.ai.error.${L}`,J=Symbol.for(X),Y=class extends m.AX{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:L,message:t}),this[n]=!0,this.role=e}static isInstance(e){return m.AX.hasMarker(e,X)}};async function q(e,t,a){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,r="image"===e.type?e.image:e.data;if("string"==typeof r)try{r=new URL(r)}catch(e){}return{mediaType:a,data:r}}).filter(e=>e.data instanceof URL&&null!=e.mediaType&&!isUrlSupported({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})).map(e=>e.data);return Object.fromEntries((await Promise.all(r.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}n=J;var V=f.z.lazy(()=>f.z.union([f.z.null(),f.z.string(),f.z.number(),f.z.boolean(),f.z.record(f.z.string(),V),f.z.array(V)])),G=f.z.record(f.z.string(),f.z.record(f.z.string(),V)),W=f.z.object({type:f.z.literal("text"),text:f.z.string(),providerOptions:G.optional()}),K=f.z.object({type:f.z.literal("image"),image:f.z.union([U,f.z.instanceof(URL)]),mediaType:f.z.string().optional(),providerOptions:G.optional()}),Q=f.z.object({type:f.z.literal("file"),data:f.z.union([U,f.z.instanceof(URL)]),filename:f.z.string().optional(),mediaType:f.z.string(),providerOptions:G.optional()}),Z=f.z.object({type:f.z.literal("reasoning"),text:f.z.string(),providerOptions:G.optional()}),H=f.z.object({type:f.z.literal("tool-call"),toolCallId:f.z.string(),toolName:f.z.string(),input:f.z.unknown(),providerOptions:G.optional(),providerExecuted:f.z.boolean().optional()}),ee=f.z.discriminatedUnion("type",[f.z.object({type:f.z.literal("text"),value:f.z.string()}),f.z.object({type:f.z.literal("json"),value:V}),f.z.object({type:f.z.literal("error-text"),value:f.z.string()}),f.z.object({type:f.z.literal("error-json"),value:V}),f.z.object({type:f.z.literal("content"),value:f.z.array(f.z.union([f.z.object({type:f.z.literal("text"),text:f.z.string()}),f.z.object({type:f.z.literal("media"),data:f.z.string(),mediaType:f.z.string()})]))})]),et=f.z.object({type:f.z.literal("tool-result"),toolCallId:f.z.string(),toolName:f.z.string(),output:ee,providerOptions:G.optional()}),ea=f.z.object({role:f.z.literal("system"),content:f.z.string(),providerOptions:G.optional()}),er=f.z.object({role:f.z.literal("user"),content:f.z.union([f.z.string(),f.z.array(f.z.union([W,K,Q]))]),providerOptions:G.optional()}),es=f.z.object({role:f.z.literal("assistant"),content:f.z.union([f.z.string(),f.z.array(f.z.union([W,Q,Z,H,et]))]),providerOptions:G.optional()}),ei=f.z.object({role:f.z.literal("tool"),content:f.z.array(et),providerOptions:G.optional()}),eo=f.z.union([ea,er,es,ei]),en={startSpan:()=>el,startActiveSpan:(e,t,a,r)=>"function"==typeof t?t(el):"function"==typeof a?a(el):"function"==typeof r?r(el):void 0},el={spanContext:()=>eu,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},eu={traceId:"",spanId:"",traceFlags:0};function ec(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:SpanStatusCode.ERROR})}function ep({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[a,r])=>{if(void 0===r)return t;if("object"==typeof r&&"input"in r&&"function"==typeof r.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=r.input();return void 0===s?t:{...t,[a]:s}}if("object"==typeof r&&"output"in r&&"function"==typeof r.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=r.output();return void 0===s?t:{...t,[a]:s}}return{...t,[a]:r}},{})}function ed(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}var eh=class{constructor({data:e,mediaType:t}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,g.k0)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,g.MS)(this.base64Data)),this.uint8ArrayData}},eg="AI_InvalidToolInputError",em=`vercel.ai.error.${eg}`,ef=Symbol.for(em),eb=class extends m.AX{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${(0,m.e$)(a)}`}){super({name:eg,message:r,cause:a}),this[l]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return m.AX.hasMarker(e,em)}};l=ef;var ez="AI_NoSuchToolError",ey=`vercel.ai.error.${ez}`,ev=Symbol.for(ey),eI=class extends m.AX{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ez,message:a}),this[u]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return m.AX.hasMarker(e,ey)}};u=ev;var eE="AI_ToolCallRepairError",eA=`vercel.ai.error.${eE}`,eT=Symbol.for(eA),ex=class extends m.AX{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,m.e$)(e)}`}){super({name:eE,message:a,cause:e}),this[c]=!0,this.originalError=t}static isInstance(e){return m.AX.hasMarker(e,eA)}};async function ew({toolCall:e,tools:t}){let a=e.toolName,r=t[a];if(null==r)throw new eI({toolName:e.toolName,availableTools:Object.keys(t)});let s=asSchema2(r.inputSchema),i=""===e.input.trim()?await safeValidateTypes2({value:{},schema:s}):await safeParseJSON({text:e.input,schema:s});if(!1===i.success)throw new eb({toolName:a,toolInput:e.input,cause:i.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:i.value,providerExecuted:e.providerExecuted}}c=eT;function eS({output:e,tool:t,errorMode:a}){return"text"===a?{type:"error-text",value:getErrorMessage4(e)}:"json"===a?{type:"error-json",value:e}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:e}}(0,g.bF)({prefix:"aitxt",size:24});function e_(e,t){let a=new Headers(null!=e?e:{});for(let[e,r]of Object.entries(t))a.has(e)||a.set(e,r);return a}TransformStream;var eR=f.z.union([f.z.strictObject({type:f.z.literal("text-start"),id:f.z.string()}),f.z.strictObject({type:f.z.literal("text-delta"),id:f.z.string(),delta:f.z.string()}),f.z.strictObject({type:f.z.literal("text-end"),id:f.z.string()}),f.z.strictObject({type:f.z.literal("error"),errorText:f.z.string()}),f.z.strictObject({type:f.z.literal("tool-input-start"),toolCallId:f.z.string(),toolName:f.z.string(),providerExecuted:f.z.boolean().optional()}),f.z.strictObject({type:f.z.literal("tool-input-delta"),toolCallId:f.z.string(),inputTextDelta:f.z.string()}),f.z.strictObject({type:f.z.literal("tool-input-available"),toolCallId:f.z.string(),toolName:f.z.string(),input:f.z.unknown(),providerExecuted:f.z.boolean().optional()}),f.z.strictObject({type:f.z.literal("tool-output-available"),toolCallId:f.z.string(),output:f.z.unknown(),providerExecuted:f.z.boolean().optional()}),f.z.strictObject({type:f.z.literal("tool-output-error"),toolCallId:f.z.string(),errorText:f.z.string(),providerExecuted:f.z.boolean().optional()}),f.z.strictObject({type:f.z.literal("reasoning"),text:f.z.string(),providerMetadata:f.z.record(f.z.string(),f.z.any()).optional()}),f.z.strictObject({type:f.z.literal("reasoning-start"),id:f.z.string(),providerMetadata:f.z.record(f.z.string(),f.z.any()).optional()}),f.z.strictObject({type:f.z.literal("reasoning-delta"),id:f.z.string(),delta:f.z.string(),providerMetadata:f.z.record(f.z.string(),f.z.any()).optional()}),f.z.strictObject({type:f.z.literal("reasoning-end"),id:f.z.string(),providerMetadata:f.z.record(f.z.string(),f.z.any()).optional()}),f.z.strictObject({type:f.z.literal("reasoning-part-finish")}),f.z.strictObject({type:f.z.literal("source-url"),sourceId:f.z.string(),url:f.z.string(),title:f.z.string().optional(),providerMetadata:f.z.any().optional()}),f.z.strictObject({type:f.z.literal("source-document"),sourceId:f.z.string(),mediaType:f.z.string(),title:f.z.string(),filename:f.z.string().optional(),providerMetadata:f.z.any().optional()}),f.z.strictObject({type:f.z.literal("file"),url:f.z.string(),mediaType:f.z.string()}),f.z.strictObject({type:f.z.string().startsWith("data-"),id:f.z.string().optional(),data:f.z.unknown(),transient:f.z.boolean().optional()}),f.z.strictObject({type:f.z.literal("start-step")}),f.z.strictObject({type:f.z.literal("finish-step")}),f.z.strictObject({type:f.z.literal("start"),messageId:f.z.string().optional(),messageMetadata:f.z.unknown().optional()}),f.z.strictObject({type:f.z.literal("finish"),messageMetadata:f.z.unknown().optional()}),f.z.strictObject({type:f.z.literal("message-metadata"),messageMetadata:f.z.unknown()})]);function ej(e,t){if(void 0===e&&void 0===t)return;if(void 0===e)return t;if(void 0===t)return e;let a={...e};for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let s=t[r];if(void 0===s)continue;let i=r in e?e[r]:void 0,o=null!==s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),n=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);o&&n?a[r]=ej(i,s):a[r]=s}return a}async function eC(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,g.NX)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,g.NX)({text:function(e){let t=["ROOT"],a=-1,r=null;function s(e,s,i){switch(e){case'"':a=s,t.pop(),t.push(i),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=s,r=s,t.pop(),t.push(i),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=s,t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"{":a=s,t.pop(),t.push(i),t.push("INSIDE_OBJECT_START");break;case"[":a=s,t.pop(),t.push(i),t.push("INSIDE_ARRAY_START")}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function o(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":s(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":i(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,s(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(r,n+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?i(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function ek(e){return e.type.startsWith("tool-")}function eN(e){return e.type.split("-")[1]}function eO(e){return"object"==typeof e&&null!==e}async function eM({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function eD(){let e,t;return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}}(0,g.bF)({prefix:"aitxt",size:24}),Symbol.for("vercel.ai.error.AI_InvalidStreamPartError"),m.AX;var eP="vercel.ai.error.AI_MCPClientError",eF=Symbol.for(eP),eB=class extends m.AX{constructor({name:e="MCPClientError",message:t,cause:a}){super({name:e,message:t,cause:a}),this[p]=!0}static isInstance(e){return m.AX.hasMarker(e,eP)}};p=eF;var eU=Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");m.AX;var e$="AI_NoObjectGeneratedError",eL=`vercel.ai.error.${e$}`,eX=Symbol.for(eL),eJ=class extends m.AX{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:s,finishReason:i}){super({name:e$,message:e,cause:t}),this[d]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=i}static isInstance(e){return m.AX.hasMarker(e,eL)}};d=eX;var eY=Symbol.for("vercel.ai.error.AI_MessageConversionError");m.AX;(0,g.bF)({prefix:"aiobj",size:24});var eq=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,g.bF)({prefix:"aiobj",size:24}),m.AX,((e,t)=>{for(var a in t)b(e,a,{get:t[a],enumerable:!0})})({},{object:()=>eG,text:()=>eV});var eV=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),eG=({schema:e})=>{let t=(0,g.C3)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await eC(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},a){let r=await (0,g.NX)({text:e});if(!r.success)throw new eJ({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await (0,g.pW)({value:r.value,schema:t});if(!s.success)throw new eJ({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}}},eW="AI_NoSuchProviderError",eK=`vercel.ai.error.${eW}`,eQ=Symbol.for(eK);m.JJ,h=eQ;var eZ=f.z.object({name:f.z.string(),version:f.z.string()}).passthrough(),eH=f.z.object({_meta:f.z.optional(f.z.object({}).passthrough())}).passthrough(),e0=f.z.object({method:f.z.string(),params:f.z.optional(eH)}),e1=f.z.object({experimental:f.z.optional(f.z.object({}).passthrough()),logging:f.z.optional(f.z.object({}).passthrough()),prompts:f.z.optional(f.z.object({listChanged:f.z.optional(f.z.boolean())}).passthrough()),resources:f.z.optional(f.z.object({subscribe:f.z.optional(f.z.boolean()),listChanged:f.z.optional(f.z.boolean())}).passthrough()),tools:f.z.optional(f.z.object({listChanged:f.z.optional(f.z.boolean())}).passthrough())}).passthrough(),e2=(eH.extend({protocolVersion:f.z.string(),capabilities:e1,serverInfo:eZ,instructions:f.z.optional(f.z.string())}),eH.extend({nextCursor:f.z.optional(f.z.string())})),e4=f.z.object({name:f.z.string(),description:f.z.optional(f.z.string()),inputSchema:f.z.object({type:f.z.literal("object"),properties:f.z.optional(f.z.object({}).passthrough())}).passthrough()}).passthrough(),e6=(e2.extend({tools:f.z.array(e4)}),f.z.object({type:f.z.literal("text"),text:f.z.string()}).passthrough()),e7=f.z.object({type:f.z.literal("image"),data:f.z.string().base64(),mimeType:f.z.string()}).passthrough(),e8=f.z.object({uri:f.z.string(),mimeType:f.z.optional(f.z.string())}).passthrough(),e3=e8.extend({text:f.z.string()}),e9=e8.extend({blob:f.z.string().base64()}),e5=f.z.object({type:f.z.literal("resource"),resource:f.z.union([e3,e9])}).passthrough(),te=(eH.extend({content:f.z.array(f.z.union([e6,e7,e5])),isError:f.z.boolean().default(!1).optional()}).or(eH.extend({toolResult:f.z.unknown()})),f.z.object({jsonrpc:f.z.literal("2.0"),id:f.z.union([f.z.string(),f.z.number().int()])}).merge(e0).strict()),tt=f.z.object({jsonrpc:f.z.literal("2.0"),id:f.z.union([f.z.string(),f.z.number().int()]),result:eH}).strict(),ta=f.z.object({jsonrpc:f.z.literal("2.0"),id:f.z.union([f.z.string(),f.z.number().int()]),error:f.z.object({code:f.z.number().int(),message:f.z.string(),data:f.z.optional(f.z.unknown())})}).strict(),tr=f.z.object({jsonrpc:f.z.literal("2.0")}).merge(f.z.object({method:f.z.string(),params:f.z.optional(eH)})).strict(),ts=f.z.union([te,tr,tt,ta]);async function ti({stream:e,onTextPart:t}){let a=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:r}=await a.read();if(e)break;await t(r)}}m.AX;var to=()=>fetch;async function tn({api:e,prompt:t,credentials:a,headers:r,body:s,streamProtocol:i="data",setCompletion:o,setLoading:n,setError:l,setAbortController:u,onFinish:c,onError:p,fetch:d=to()}){var h;try{n(!0),l(void 0);let p=new AbortController;u(p),o("");let m=await d(e,{method:"POST",body:JSON.stringify({prompt:t,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:p.signal}).catch(e=>{throw e});if(!m.ok)throw Error(null!=(h=await m.text())?h:"Failed to fetch the chat response.");if(!m.body)throw Error("The response body is empty.");let f="";switch(i){case"text":await ti({stream:m.body,onTextPart:e=>{f+=e,o(f)}});break;case"data":await eM({stream:(0,g.RF)({stream:m.body,schema:eR}).pipeThrough(new TransformStream({async transform(e){if(!e.success)throw e.error;let t=e.value;if("text-delta"===t.type)f+=t.delta,o(f);else if("error"===t.type)throw Error(t.errorText)}})),onError:e=>{throw e}});break;default:throw Error(`Unknown stream protocol: ${i}`)}return c&&c(t,f),u(null),f}catch(e){if("AbortError"===e.name)return u(null),null;e instanceof Error&&p&&p(e),l(e)}finally{n(!1)}}async function tl(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}var tu=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:s,prepareSendMessagesRequest:i,prepareReconnectToStreamRequest:o}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=i,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:e,...t}){var a,r,s,i,o;let n=await (0,g.DB)(this.body),l=await (0,g.DB)(this.headers),u=await (0,g.DB)(this.credentials),c=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:{...l,...t.headers},credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),p=null!=(r=null==c?void 0:c.api)?r:this.api,d=(null==c?void 0:c.headers)!==void 0?c.headers:{...l,...t.headers},h=(null==c?void 0:c.body)!==void 0?c.body:{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},m=null!=(s=null==c?void 0:c.credentials)?s:u,f=null!=(i=this.fetch)?i:globalThis.fetch,b=await f(p,{method:"POST",headers:{"Content-Type":"application/json",...d},body:JSON.stringify(h),credentials:m,signal:e});if(!b.ok)throw Error(null!=(o=await b.text())?o:"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");return this.processResponseStream(b.body)}async reconnectToStream(e){var t,a,r,s,i;let o=await (0,g.DB)(this.body),n=await (0,g.DB)(this.headers),l=await (0,g.DB)(this.credentials),u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...o,...e.body},headers:{...n,...e.headers},credentials:l,requestMetadata:e.metadata})),c=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,p=(null==u?void 0:u.headers)!==void 0?u.headers:{...n,...e.headers},d=null!=(r=null==u?void 0:u.credentials)?r:l,h=null!=(s=this.fetch)?s:globalThis.fetch,m=await h(c,{method:"GET",headers:p,credentials:d});if(204===m.status)return null;if(!m.ok)throw Error(null!=(i=await m.text())?i:"Failed to fetch the chat response.");if(!m.body)throw Error("The response body is empty.");return this.processResponseStream(m.body)}},tc=class extends tu{constructor(e={}){super(e)}processResponseStream(e){return(0,g.RF)({stream:e,schema:eR}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}};function tp(e){if(!e||"assistant"!==e.role)return!1;let t=e.parts.reduce((e,t,a)=>"step-start"===t.type?a:e,-1),a=e.parts.slice(t+1).filter(ek);return a.length>0&&a.every(e=>"output-available"===e.state)}var td=class{constructor({generateId:e=g.Ox,id:t=e(),transport:a=new tc,maxSteps:r=1,messageMetadataSchema:s,dataPartSchemas:i,state:o,onError:n,onToolCall:l,onFinish:u,onData:c}){this.activeResponse=void 0,this.jobExecutor=new eq,this.sendMessage=async(e,t={})=>{var a,r,s;let i;if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await tl(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(a=i.role)?a:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(r=i.id)?r:this.generateId(),role:null!=(s=i.role)?s:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-user-message",messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-assistant-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.addToolResult=async({toolCallId:e,output:t})=>{this.jobExecutor.run(async()=>{(function({messages:e,toolCallId:t,output:a}){let r=e[e.length-1].parts.find(e=>ek(e)&&e.toolCallId===t);null!=r&&(r.state="output-available",r.output=a)})({messages:this.state.messages,toolCallId:e,output:t}),this.messages=this.state.messages,"submitted"!==this.status&&"streaming"!==this.status&&tp(this.lastMessage)&&this.makeRequest({trigger:"submit-tool-result"})})},this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.maxSteps=r,this.transport=a,this.generateId=e,this.messageMetadataSchema=s,this.dataPartSchemas=i,this.state=o,this.onError=n,this.onToolCall=l,this.onFinish=u,this.onData=c}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:s}){var i,o;this.setStatus({status:"submitted",error:void 0});let n=this.state.messages.length,l=this.lastMessage,u=null!=(i=null==l?void 0:l.parts.filter(e=>"step-start"===e.type).length)?i:0;try{let i;let n={state:function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(l),messageId:this.generateId()}),abortController:new AbortController};if(this.activeResponse=n,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e)return;i=e}else i=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:n.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:s});await eM({stream:function({stream:e,onToolCall:t,messageMetadataSchema:a,dataPartSchemas:r,runUpdateMessageJob:s,onError:i,onData:o}){return e.pipeThrough(new TransformStream({async transform(e,r){await s(async({state:s,write:n})=>{var l,u;function c(e){var t;let a=s.message.parts.find(t=>ek(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted):s.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,providerExecuted:e.providerExecuted})}async function p(e){if(null!=e){let t=null!=s.message.metadata?ej(s.message.metadata,e):e;null!=a&&await (0,g.rJ)({value:t,schema:a}),s.message.metadata=t}}switch(e.type){case"text-start":{let t={type:"text",text:"",state:"streaming"};s.activeTextParts[e.id]=t,s.message.parts.push(t),n();break}case"text-delta":s.activeTextParts[e.id].text+=e.delta,n();break;case"text-end":s.activeTextParts[e.id].state="done",delete s.activeTextParts[e.id],n();break;case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};s.activeReasoningParts[e.id]=t,s.message.parts.push(t),n();break}case"reasoning-delta":{let t=s.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(l=e.providerMetadata)?l:t.providerMetadata,n();break}case"reasoning-end":{let t=s.activeReasoningParts[e.id];t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,t.state="done",delete s.activeReasoningParts[e.id],n();break}case"file":s.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),n();break;case"source-url":s.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),n();break;case"source-document":s.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),n();break;case"tool-input-start":{let t=s.message.parts.filter(ek);s.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length},c({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),n();break}case"tool-input-delta":{let t=s.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await eC(t.text);c({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),n();break}case"tool-input-available":if(c({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted}),n(),t&&!e.providerExecuted){let a=await t({toolCall:e});null!=a&&(c({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-available",input:e.input,output:a}),n())}break;case"tool-output-available":{let t=s.message.parts.filter(ek);if(null==t)throw Error("tool_result must be preceded by a tool_call");let a=t.findIndex(t=>t.toolCallId===e.toolCallId);if(-1===a)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");let r=eN(t[a]);c({toolCallId:e.toolCallId,toolName:r,state:"output-available",input:t[a].input,output:e.output,providerExecuted:e.providerExecuted}),n();break}case"tool-output-error":{let t=s.message.parts.filter(ek);if(null==t)throw Error("tool_result must be preceded by a tool_call");let a=t.findIndex(t=>t.toolCallId===e.toolCallId);if(-1===a)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");let r=eN(t[a]);c({toolCallId:e.toolCallId,toolName:r,state:"output-error",input:t[a].input,errorText:e.errorText,providerExecuted:e.providerExecuted}),n();break}case"start-step":s.message.parts.push({type:"step-start"});break;case"finish-step":s.activeTextParts={},s.activeReasoningParts={};break;case"start":null!=e.messageId&&(s.message.id=e.messageId),await p(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&n();break;case"finish":case"message-metadata":await p(e.messageMetadata),null!=e.messageMetadata&&n();break;case"error":null==i||i(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if(e.transient){null==o||o(e);break}let t=null!=e.id?s.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=eO(t.data)&&eO(e.data)?ej(t.data,e.data):e.data:s.message.parts.push(e),null==o||o(e),n()}}r.enqueue(e)})}}))}({stream:i,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:n.state,write:()=>{var e;this.setStatus({status:"streaming"}),n.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,n.state.message):this.state.pushMessage(n.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),null==(o=this.onFinish)||o.call(this,{message:n.state.message}),this.setStatus({status:"ready"})}catch(e){if("AbortError"===e.name)return this.setStatus({status:"ready"}),null;this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{this.activeResponse=void 0}(function({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:a,messages:r}){let s=r[r.length-1],i=s.parts.filter(e=>"step-start"===e.type).length;return a>1&&null!=s&&(r.length>t||i!==e)&&tp(s)&&i<a})({originalMaxToolInvocationStep:u,originalMessageCount:n,maxSteps:this.maxSteps,messages:this.state.messages})&&await this.makeRequest({metadata:t,headers:a,body:r,trigger:"submit-tool-result"})}}}}]);