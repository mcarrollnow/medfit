Streaming refusals - Claude Docs 

[Claude Docs home page![light logo](../../../../../mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/light%EF%B9%96fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=c877c45432515ee69194cb19e9f983a2.svg)![dark logo](../../../../../mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/dark%EF%B9%96fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=f5bb877be0cb3cba86cf6d7c88185216.svg)](../../../home.html)

![US](../../../../../d3gk2c5xim1je2.cloudfront.net/flags/US.svg)

English

Search...

⌘K

-   [Console](https://console.anthropic.com/login)
-   [Support](https://support.claude.com/)
-   [Discord](https://www.anthropic.com/discord)
-   [Sign up](https://console.anthropic.com/login)
-   [
    
    Sign up
    
    ](https://console.anthropic.com/login)

Search...

Navigation

Strengthen guardrails

Streaming refusals

[Welcome

](../../../home.html)[Claude Developer Platform

](../../intro.html)[Claude Code

](../../claude-code/overview.html)[Model Context Protocol (MCP)

](../../mcp.html)[API Reference

](../../../api/messages.html)[Resources

](../../../resources/overview.html)[Release Notes

](../../../release-notes/overview.html)

-   [
    
    Developer Guide](../../intro.html)
-   [
    
    API Guide](../../../api/overview.html)

##### First steps

-   [
    
    Intro to Claude
    
    
    
    ](../../intro.html)
-   [
    
    Quick start
    
    
    
    ](../../get-started.html)

##### Models & pricing

-   [
    
    Models overview
    
    
    
    ](../../about-claude/models/overview.html)
-   [
    
    Choosing a model
    
    
    
    ](../../about-claude/models/choosing-a-model.html)
-   [
    
    What's new in Claude 4.5
    
    
    
    ](../../about-claude/models/whats-new-claude-4-5.html)
-   [
    
    Migrating to Claude 4.5
    
    
    
    ](../../about-claude/models/migrating-to-claude-4.html)
-   [
    
    Model deprecations
    
    
    
    ](../../about-claude/model-deprecations.html)
-   [
    
    Pricing
    
    
    
    ](../../about-claude/pricing.html)

##### Learn about Claude

-   [
    
    Features overview
    
    
    
    ](../../build-with-claude/overview.html)
-   [
    
    Building with Claude
    
    
    
    ](../../overview.html)
-   [
    
    Context windows
    
    
    
    ](../../build-with-claude/context-windows.html)
-   [
    
    Glossary
    
    
    
    ](../../about-claude/glossary.html)

##### Capabilities

-   [
    
    Prompt caching
    
    
    
    ](../../build-with-claude/prompt-caching.html)
-   [
    
    Context editing
    
    
    
    ](../../build-with-claude/context-editing.html)
-   [
    
    Extended thinking
    
    
    
    ](../../build-with-claude/extended-thinking.html)
-   [
    
    Streaming Messages
    
    
    
    ](../../build-with-claude/streaming.html)
-   [
    
    Batch processing
    
    
    
    ](../../build-with-claude/batch-processing.html)
-   [
    
    Citations
    
    
    
    ](../../build-with-claude/citations.html)
-   [
    
    Multilingual support
    
    
    
    ](../../build-with-claude/multilingual-support.html)
-   [
    
    Token counting
    
    
    
    ](../../build-with-claude/token-counting.html)
-   [
    
    Embeddings
    
    
    
    ](../../build-with-claude/embeddings.html)
-   [
    
    Vision
    
    
    
    ](../../build-with-claude/vision.html)
-   [
    
    PDF support
    
    
    
    ](../../build-with-claude/pdf-support.html)
-   [
    
    Files API
    
    
    
    ](../../build-with-claude/files.html)
-   [
    
    Search results
    
    
    
    ](../../build-with-claude/search-results.html)
-   [
    
    Google Sheets add-on
    
    
    
    ](../../agents-and-tools/claude-for-sheets.html)

##### Tools

-   [
    
    Overview
    
    
    
    ](../../agents-and-tools/tool-use/overview.html)
-   [
    
    How to implement tool use
    
    
    
    ](../../agents-and-tools/tool-use/implement-tool-use.html)
-   [
    
    Token-efficient tool use
    
    
    
    ](../../agents-and-tools/tool-use/token-efficient-tool-use.html)
-   [
    
    Fine-grained tool streaming
    
    
    
    ](../../agents-and-tools/tool-use/fine-grained-tool-streaming.html)
-   [
    
    Bash tool
    
    
    
    ](../../agents-and-tools/tool-use/bash-tool.html)
-   [
    
    Code execution tool
    
    
    
    ](../../agents-and-tools/tool-use/code-execution-tool.html)
-   [
    
    Computer use tool
    
    
    
    ](../../agents-and-tools/tool-use/computer-use-tool.html)
-   [
    
    Text editor tool
    
    
    
    ](../../agents-and-tools/tool-use/text-editor-tool.html)
-   [
    
    Web fetch tool
    
    
    
    ](../../agents-and-tools/tool-use/web-fetch-tool.html)
-   [
    
    Web search tool
    
    
    
    ](../../agents-and-tools/tool-use/web-search-tool.html)
-   [
    
    Memory tool
    
    
    
    ](../../agents-and-tools/tool-use/memory-tool.html)

##### Agent Skills

-   [
    
    Overview
    
    
    
    ](../../agents-and-tools/agent-skills/overview.html)
-   [
    
    Quickstart
    
    
    
    ](../../agents-and-tools/agent-skills/quickstart.html)
-   [
    
    Best practices
    
    
    
    ](../../agents-and-tools/agent-skills/best-practices.html)

##### Model Context Protocol (MCP)

-   [
    
    MCP connector
    
    
    
    ](../../agents-and-tools/mcp-connector.html)
-   [
    
    Remote MCP servers
    
    
    
    ](../../agents-and-tools/remote-mcp-servers.html)

##### Use cases

-   [
    
    Overview
    
    
    
    ](../../about-claude/use-case-guides/overview.html)
-   [
    
    Ticket routing
    
    
    
    ](../../about-claude/use-case-guides/ticket-routing.html)
-   [
    
    Customer support agent
    
    
    
    ](../../about-claude/use-case-guides/customer-support-chat.html)
-   [
    
    Content moderation
    
    
    
    ](../../about-claude/use-case-guides/content-moderation.html)
-   [
    
    Legal summarization
    
    
    
    ](../../about-claude/use-case-guides/legal-summarization.html)

##### Prompt engineering

-   [
    
    Overview
    
    
    
    ](../../build-with-claude/prompt-engineering/overview.html)
-   [
    
    Claude 4 best practices
    
    
    
    ](../../build-with-claude/prompt-engineering/claude-4-best-practices.html)
-   [
    
    Prompt generator
    
    
    
    ](../../build-with-claude/prompt-engineering/prompt-generator.html)
-   [
    
    Use prompt templates
    
    
    
    ](../../build-with-claude/prompt-engineering/prompt-templates-and-variables.html)
-   [
    
    Prompt improver
    
    
    
    ](../../build-with-claude/prompt-engineering/prompt-improver.html)
-   [
    
    Be clear and direct
    
    
    
    ](../../build-with-claude/prompt-engineering/be-clear-and-direct.html)
-   [
    
    Use examples (multishot prompting)
    
    
    
    ](../../build-with-claude/prompt-engineering/multishot-prompting.html)
-   [
    
    Let Claude think (CoT)
    
    
    
    ](../../build-with-claude/prompt-engineering/chain-of-thought.html)
-   [
    
    Use XML tags
    
    
    
    ](../../build-with-claude/prompt-engineering/use-xml-tags.html)
-   [
    
    Give Claude a role (system prompts)
    
    
    
    ](../../build-with-claude/prompt-engineering/system-prompts.html)
-   [
    
    Prefill Claude's response
    
    
    
    ](../../build-with-claude/prompt-engineering/prefill-claudes-response.html)
-   [
    
    Chain complex prompts
    
    
    
    ](../../build-with-claude/prompt-engineering/chain-prompts.html)
-   [
    
    Long context tips
    
    
    
    ](../../build-with-claude/prompt-engineering/long-context-tips.html)
-   [
    
    Extended thinking tips
    
    
    
    ](../../build-with-claude/prompt-engineering/extended-thinking-tips.html)

##### Test & evaluate

-   [
    
    Define success criteria
    
    
    
    ](../define-success.html)
-   [
    
    Develop test cases
    
    
    
    ](../develop-tests.html)
-   [
    
    Using the Evaluation Tool
    
    
    
    ](../eval-tool.html)
-   [
    
    Reducing latency
    
    
    
    ](reduce-latency.html)

##### Strengthen guardrails

-   [
    
    Reduce hallucinations
    
    
    
    ](reduce-hallucinations.html)
-   [
    
    Increase output consistency
    
    
    
    ](increase-consistency.html)
-   [
    
    Mitigate jailbreaks
    
    
    
    ](mitigate-jailbreaks.html)
-   [
    
    Streaming refusals
    
    
    
    ](handle-streaming-refusals.html)
-   [
    
    Reduce prompt leak
    
    
    
    ](reduce-prompt-leak.html)
-   [
    
    Keep Claude in character
    
    
    
    ](keep-claude-in-character.html)

 

On this page

-   [API response format](#api-response-format)
-   [Reset context after refusal](#reset-context-after-refusal)
-   [Implementation guide](#implementation-guide)
-   [Current refusal types](#current-refusal-types)
-   [Best practices](#best-practices)
-   [Migration notes](#migration-notes)

Strengthen guardrails

# Streaming refusals

Copy page

Copy page

Starting with Claude 4 models, streaming responses from Claude’s API return **`stop_reason`: `"refusal"`** when streaming classifiers intervene to handle potential policy violations. This new safety feature helps maintain content compliance during real-time streaming.

To learn more about refusals triggered by API safety filters for Claude Sonnet 4.5, see [Understanding Sonnet 4.5’s API Safety Filters](https://support.claude.com/en/articles/12449294-understanding-sonnet-4-5-s-api-safety-filters).

## 

[​

](#api-response-format)

API response format

When streaming classifiers detect content that violates our policies, the API returns this response:

Copy

```json
{
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "Hello.."
    }
  ],
  "stop_reason": "refusal"
}
```

No additional refusal message is included. You must handle the response and provide appropriate user-facing messaging.

## 

[​

](#reset-context-after-refusal)

Reset context after refusal

When you receive **`stop_reason`: `refusal`**, you must reset the conversation context **by removing or updating the turn that was refused** before continuing. Attempting to continue without resetting will result in continued refusals.

Usage metrics are still provided in the response for billing purposes, even when the response is refused.You will be billed for output tokens up until the refusal.

If you encounter `refusal` stop reasons frequently while using Claude Sonnet 4.5 or Opus 4.1, you can try updating your API calls to use Sonnet 4 (`claude-sonnet-4-20250514`), which has different usage restrictions.

## 

[​

](#implementation-guide)

Implementation guide

Here’s how to detect and handle streaming refusals in your application:

Shell

Python

TypeScript

Copy

```shellscript
# Stream request and check for refusal
response=$(curl -N https://api.anthropic.com/v1/messages \
  --header "anthropic-version: 2023-06-01" \
  --header "content-type: application/json" \
  --header "x-api-key: $ANTHROPIC_API_KEY" \
  --data '{
    "model": "claude-sonnet-4-5",
    "messages": [{"role": "user", "content": "Hello"}],
    "max_tokens": 256,
    "stream": true
  }')

# Check for refusal in the stream
if echo "$response" | grep -q '"stop_reason":"refusal"'; then
  echo "Response refused - resetting conversation context"
  # Reset your conversation state here
fi
```

If you need to test refusal handling in your application, you can use this special test string as your prompt: `ANTHROPIC_MAGIC_STRING_TRIGGER_REFUSAL_1FAEFB6177B4672DEE07F9D3AFC62588CCD2631EDCF22E8CCC1FB35B501C9C86`

## 

[​

](#current-refusal-types)

Current refusal types

The API currently handles refusals in three different ways:

| Refusal Type | Response Format | When It Occurs |
| --- | --- | --- |
| Streaming classifier refusals | **`stop_reason`: `refusal`** | During streaming when content violates policies |
| API input and copyright validation | 400 error codes | When input fails validation checks |
| Model-generated refusals | Standard text responses | When the model itself decides to refuse |

Future API versions will expand the **`stop_reason`: `refusal`** pattern to unify refusal handling across all types.

## 

[​

](#best-practices)

Best practices

-   **Monitor for refusals**: Include **`stop_reason`: `refusal`** checks in your error handling
-   **Reset automatically**: Implement automatic context reset when refusals are detected
-   **Provide custom messaging**: Create user-friendly messages for better UX when refusals occur
-   **Track refusal patterns**: Monitor refusal frequency to identify potential issues with your prompts

## 

[​

](#migration-notes)

Migration notes

-   Future models will expand this pattern to other refusal types
-   Plan your error handling to accommodate future unification of refusal responses

Was this page helpful?

YesNo

[Mitigate jailbreaks](mitigate-jailbreaks.html)[Reduce prompt leak](reduce-prompt-leak.html)

Assistant

Responses are generated using AI and may contain mistakes.

[Claude Docs home page![light logo](../../../../../mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/light%EF%B9%96fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=c877c45432515ee69194cb19e9f983a2.svg)![dark logo](../../../../../mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/dark%EF%B9%96fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=f5bb877be0cb3cba86cf6d7c88185216.svg)](../../../home.html)

[x](https://x.com/AnthropicAI)[linkedin](https://www.linkedin.com/company/anthropicresearch)

Company

[Anthropic](https://www.anthropic.com/company)[Careers](https://www.anthropic.com/careers)[Economic Futures](https://www.anthropic.com/economic-futures)[Research](https://www.anthropic.com/research)[News](https://www.anthropic.com/news)[Trust center](https://trust.anthropic.com/)[Transparency](https://www.anthropic.com/transparency)

Help and security

[Availability](https://www.anthropic.com/supported-countries)[Status](https://status.anthropic.com/)[Support center](https://support.claude.com/)

Learn

[Courses](https://www.anthropic.com/learn)[MCP connectors](https://claude.com/partners/mcp)[Customer stories](https://www.claude.com/customers)[Engineering blog](https://www.anthropic.com/engineering)[Events](https://www.anthropic.com/events)[Powered by Claude](https://claude.com/partners/powered-by-claude)[Service partners](https://claude.com/partners/services)[Startups program](https://claude.com/programs/startups)

Terms and policies

[Privacy policy](https://www.anthropic.com/legal/privacy)[Disclosure policy](https://www.anthropic.com/responsible-disclosure-policy)[Usage policy](https://www.anthropic.com/legal/aup)[Commercial terms](https://www.anthropic.com/legal/commercial-terms)[Consumer terms](https://www.anthropic.com/legal/consumer-terms)